<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Updating a validator | Commercio.network Documentation</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/icon.png">
    <meta name="description" content="Documentation for the Commercio.network blockchain.">
    
    <link rel="preload" href="/assets/css/0.styles.8e1282c7.css" as="style"><link rel="preload" href="/assets/js/app.e5cb1680.js" as="script"><link rel="preload" href="/assets/js/2.5e9ff84b.js" as="script"><link rel="preload" href="/assets/js/27.fc3305c3.js" as="script"><link rel="prefetch" href="/assets/js/10.0b74a5ca.js"><link rel="prefetch" href="/assets/js/11.09bfc103.js"><link rel="prefetch" href="/assets/js/12.2878174b.js"><link rel="prefetch" href="/assets/js/13.7dad74ad.js"><link rel="prefetch" href="/assets/js/14.6ffab083.js"><link rel="prefetch" href="/assets/js/15.5b15ac01.js"><link rel="prefetch" href="/assets/js/16.94dde7c6.js"><link rel="prefetch" href="/assets/js/17.966d1132.js"><link rel="prefetch" href="/assets/js/18.4aa09732.js"><link rel="prefetch" href="/assets/js/19.d7f3fc4e.js"><link rel="prefetch" href="/assets/js/20.4d4e13b2.js"><link rel="prefetch" href="/assets/js/21.bc56f278.js"><link rel="prefetch" href="/assets/js/22.5cd169ad.js"><link rel="prefetch" href="/assets/js/23.76ce0042.js"><link rel="prefetch" href="/assets/js/24.a30e7a41.js"><link rel="prefetch" href="/assets/js/25.91a90283.js"><link rel="prefetch" href="/assets/js/26.8e268592.js"><link rel="prefetch" href="/assets/js/28.d50c23ca.js"><link rel="prefetch" href="/assets/js/29.adf44f82.js"><link rel="prefetch" href="/assets/js/3.adb0b640.js"><link rel="prefetch" href="/assets/js/30.82fffe13.js"><link rel="prefetch" href="/assets/js/31.42e033ce.js"><link rel="prefetch" href="/assets/js/32.45462a64.js"><link rel="prefetch" href="/assets/js/33.794ee60a.js"><link rel="prefetch" href="/assets/js/34.ba99ec19.js"><link rel="prefetch" href="/assets/js/35.7c7d1c3c.js"><link rel="prefetch" href="/assets/js/36.341d0b53.js"><link rel="prefetch" href="/assets/js/37.f3e5580a.js"><link rel="prefetch" href="/assets/js/38.a2461db6.js"><link rel="prefetch" href="/assets/js/39.0b2a857d.js"><link rel="prefetch" href="/assets/js/4.178e40ad.js"><link rel="prefetch" href="/assets/js/40.d14516b8.js"><link rel="prefetch" href="/assets/js/41.68955085.js"><link rel="prefetch" href="/assets/js/42.0faffde4.js"><link rel="prefetch" href="/assets/js/43.45eae0f8.js"><link rel="prefetch" href="/assets/js/44.1eba555a.js"><link rel="prefetch" href="/assets/js/45.04f7de75.js"><link rel="prefetch" href="/assets/js/46.95b74f0d.js"><link rel="prefetch" href="/assets/js/47.4a304269.js"><link rel="prefetch" href="/assets/js/48.878f0c52.js"><link rel="prefetch" href="/assets/js/49.19ba9427.js"><link rel="prefetch" href="/assets/js/5.ab3fa53c.js"><link rel="prefetch" href="/assets/js/50.43470a66.js"><link rel="prefetch" href="/assets/js/51.7686be54.js"><link rel="prefetch" href="/assets/js/52.20c81a6d.js"><link rel="prefetch" href="/assets/js/53.4e1af573.js"><link rel="prefetch" href="/assets/js/54.f54ff707.js"><link rel="prefetch" href="/assets/js/55.c531b08f.js"><link rel="prefetch" href="/assets/js/56.39a27012.js"><link rel="prefetch" href="/assets/js/57.45f7a701.js"><link rel="prefetch" href="/assets/js/58.73c528c1.js"><link rel="prefetch" href="/assets/js/59.93a5f5e6.js"><link rel="prefetch" href="/assets/js/6.206797ec.js"><link rel="prefetch" href="/assets/js/60.2182a71b.js"><link rel="prefetch" href="/assets/js/61.78d9af3e.js"><link rel="prefetch" href="/assets/js/62.06a64a25.js"><link rel="prefetch" href="/assets/js/63.fb7a8e64.js"><link rel="prefetch" href="/assets/js/64.a02df04b.js"><link rel="prefetch" href="/assets/js/65.98b1547b.js"><link rel="prefetch" href="/assets/js/66.7da824cd.js"><link rel="prefetch" href="/assets/js/67.5810ecde.js"><link rel="prefetch" href="/assets/js/68.f0908edc.js"><link rel="prefetch" href="/assets/js/69.035af226.js"><link rel="prefetch" href="/assets/js/7.f5ec9eb5.js"><link rel="prefetch" href="/assets/js/70.39672691.js"><link rel="prefetch" href="/assets/js/71.5415c3b1.js"><link rel="prefetch" href="/assets/js/72.41cfee03.js"><link rel="prefetch" href="/assets/js/73.493d5162.js"><link rel="prefetch" href="/assets/js/74.70371638.js"><link rel="prefetch" href="/assets/js/75.31dcc1d6.js"><link rel="prefetch" href="/assets/js/76.3fc4a106.js"><link rel="prefetch" href="/assets/js/77.09701c20.js"><link rel="prefetch" href="/assets/js/78.799a7d80.js"><link rel="prefetch" href="/assets/js/79.ef6e2e8c.js"><link rel="prefetch" href="/assets/js/8.3c3412c0.js"><link rel="prefetch" href="/assets/js/80.059cd75c.js"><link rel="prefetch" href="/assets/js/81.85fb8d41.js"><link rel="prefetch" href="/assets/js/82.023dd780.js"><link rel="prefetch" href="/assets/js/83.460391e5.js"><link rel="prefetch" href="/assets/js/84.60e71a1e.js"><link rel="prefetch" href="/assets/js/85.73dfa69d.js"><link rel="prefetch" href="/assets/js/86.2a8ef5d6.js"><link rel="prefetch" href="/assets/js/87.d3ab0e2c.js"><link rel="prefetch" href="/assets/js/88.56679b95.js"><link rel="prefetch" href="/assets/js/89.9170bcf1.js"><link rel="prefetch" href="/assets/js/9.f8bca335.js"><link rel="prefetch" href="/assets/js/90.e146ee20.js"><link rel="prefetch" href="/assets/js/91.1e72e0b6.js"><link rel="prefetch" href="/assets/js/92.0632a204.js"><link rel="prefetch" href="/assets/js/93.cb24ce6a.js"><link rel="prefetch" href="/assets/js/94.a6ae7200.js"><link rel="prefetch" href="/assets/js/95.16936822.js"><link rel="prefetch" href="/assets/js/96.24856667.js"><link rel="prefetch" href="/assets/js/97.736130c5.js"><link rel="prefetch" href="/assets/js/98.8003b59a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8e1282c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Commercio.network Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://commercio.network" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Commercio.network
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">
  ver 2.2.0
</a></div><div class="nav-item"><a href="/docs2.1.2/" class="nav-link router-link-active">
  ver 2.1.2
</a></div> <a href="https://github.com/commercionetwork/commercionetwork" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://commercio.network" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Commercio.network
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">
  ver 2.2.0
</a></div><div class="nav-item"><a href="/docs2.1.2/" class="nav-link router-link-active">
  ver 2.1.2
</a></div> <a href="https://github.com/commercionetwork/commercionetwork" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Nodes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nodes/" class="sidebar-link">Introduction</a></li><li><a href="/nodes/hardware-requirements.html" class="sidebar-link">Hardware requirements</a></li><li><a href="/nodes/full-node-installation.html" class="sidebar-link">Installing a full node</a></li><li><a href="/nodes/validator-node-installation.html" class="sidebar-link">Becoming a validator</a></li><li><a href="/nodes/validator-node-handling.html" class="sidebar-link">Handling a validator</a></li><li><a href="/nodes/validator-node-update.html" class="sidebar-link">Updating a validator</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>App Developers</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/app_developers/" class="sidebar-link">Introduction</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>SDK Developers</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/developers/" class="sidebar-link">Introduction</a></li><li><a href="/developers/create-sign-broadcast-tx.html" class="sidebar-link">Create, sign and send a transaction</a></li><li><a href="/developers/message-types.html" class="sidebar-link">Supported messages types</a></li><li><a href="/developers/listing-transactions.html" class="sidebar-link">Listing past transactions</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Modules</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/x/bank/" class="sidebar-link">Bank</a></li><li><a href="/x/government/" class="sidebar-link">Government</a></li><li><a href="/x/id/" class="sidebar-link">Id</a></li><li><a href="/x/documents/" class="sidebar-link">Docs</a></li><li><a href="/x/commerciomint/" class="sidebar-link">CommercioMint</a></li><li><a href="/x/commerciokyc/" class="sidebar-link">CommercioKYC</a></li><li><a href="/x/vbr/" class="sidebar-link">VBR</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ver 2.1.2</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs2.1.2/" aria-current="page" class="sidebar-link">ver 2.1.2</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Nodes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs2.1.2/nodes/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/docs2.1.2/nodes/hardware-requirements.html" class="sidebar-link">Hardware requirements</a></li><li><a href="/docs2.1.2/nodes/full-node-installation.html" class="sidebar-link">Installing a full node</a></li><li><a href="/docs2.1.2/nodes/validator-node-installation.html" class="sidebar-link">Becoming a validator</a></li><li><a href="/docs2.1.2/nodes/validator-node-handling.html" class="sidebar-link">Handling a validator</a></li><li><a href="/docs2.1.2/nodes/validator-node-update.html" aria-current="page" class="active sidebar-link">Updating a validator</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#update-type-1-hard-fork" class="sidebar-link">Update type 1 - Hard fork</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#preliminary-risks" class="sidebar-link">Preliminary/Risks</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#install-support-software" class="sidebar-link">Install support software</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#setup-environment" class="sidebar-link">Setup environment</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#compile-new-executables" class="sidebar-link">Compile new executables</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#setup-height-to-stop-the-chain" class="sidebar-link">Setup height to stop the chain</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#control-if-chain-is-stopped" class="sidebar-link">Control if chain is stopped</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#stop-services" class="sidebar-link">Stop services</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#export-chain-state" class="sidebar-link">Export chain state</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#backup-executables" class="sidebar-link">Backup executables</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#changing-executables" class="sidebar-link">Changing executables</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#migrate-chain" class="sidebar-link">Migrate chain</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#check-hash-of-genesis" class="sidebar-link">Check hash of genesis</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#backup" class="sidebar-link">Backup</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#reset-chain-and-change-geneis-file" class="sidebar-link">Reset chain and change geneis file</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#restart-chain" class="sidebar-link">Restart chain</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#control-chain-restart" class="sidebar-link">Control chain restart</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#restart-the-rest-api-if-you-need" class="sidebar-link">Restart the REST API if you need</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#update-type-2-soft-fork" class="sidebar-link">Update type 2 - Soft fork</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#preliminary-risks-2" class="sidebar-link">Preliminary/Risks</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#setup-environment-2" class="sidebar-link">Setup environment</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#compile-new-executables-2" class="sidebar-link">Compile new executables</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#backup-executables-2" class="sidebar-link">Backup executables</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#restart-chain-changing-executables" class="sidebar-link">Restart chain changing executables</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#control-chain-restart-2" class="sidebar-link">Control chain restart</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#update-type-3-reset-reinstall-chain" class="sidebar-link">Update type 3 - Reset/reinstall chain</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#backup-executables-3" class="sidebar-link">Backup executables</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#backup-chain-database" class="sidebar-link">Backup chain database</a></li><li class="sidebar-sub-header"><a href="/docs2.1.2/nodes/validator-node-update.html#reinstall-node" class="sidebar-link">Reinstall node</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>App Developers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>SDK Developers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Modules</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="updating-a-validator"><a href="#updating-a-validator" class="header-anchor">#</a> Updating a validator</h1> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>If you are a new validator you need follow the <a href="/docs2.1.2/nodes/validator-node-installation.html"><em>&quot;Becoming a validator&quot;</em> procedure</a>.<br> <strong>DO NOT USE THIS UPDATE PROCEDURES</strong></p></div> <p>This section describes the procedure that needs to be followed in order to update a validator node from one
version to another.</p> <p>For updating will be sent to the validators the type and a brief explanation of the steps to be taken.<br>
This guide contains only a general basic explanation of the procedures to be applied.</p> <p>In general there are 3 types of updates</p> <ul><li>Update type <a href="#update-type-1-hard-fork"><code>1 - Hard fork</code></a></li> <li>Update type <a href="#update-type-2-soft-fork"><code>2 - Soft fork</code></a></li> <li>Update type <a href="#update-type-3-reset-reinstall-chain"><code>3 - Reset/reinstall chain</code></a></li></ul> <h2 id="update-type-1-hard-fork"><a href="#update-type-1-hard-fork" class="header-anchor">#</a> Update type 1 - Hard fork</h2> <p>In this case, the chain state will be preserved from its beginning to a certain point in time.</p> <h3 id="preliminary-risks"><a href="#preliminary-risks" class="header-anchor">#</a> Preliminary/Risks</h3> <p>When signalling a required update that should follow this procedure, the following information will
be let known to all validators:</p> <ol><li>A specific block height to stop chain: <code>&lt;stop_block_height&gt;</code></li> <li>The new chain software version: <code>&lt;new_version&gt;</code></li> <li>A deadline expressed in UTC format</li> <li>A new genesis_time in UTC format (something like 2020-06-12T08:55:00Z): <code>&lt;genesis_time&gt;</code></li> <li>The new chain_id: <code>&lt;new_chain_id&gt;</code></li> <li>The old chain_id: <code>&lt;old_chain_id&gt;</code></li></ol> <p>If you are a validator, please make sure that you know all those information before proceeding with the update.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You should reach <a href="#setup-height-to-stop-the-chain">Setup height to stop the chain</a> point before update event.<br>
You prepare all settings as soon as you become aware of the update data</p></div> <div class="custom-block danger"><p class="custom-block-title">Double signing</p> <p>Due to the nature of the update operations, there is some risk of double signature.
To avoid every sort of risks please verify the software version, the hash of the <code>genesis.json</code> file and the specific
configuration present inside the <code>config.toml</code> file.</p></div> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>Update time<br>
The deadline of the update must be respected: every validator that will not update just in time will be slashed as offline node.</p></div> <h3 id="install-support-software"><a href="#install-support-software" class="header-anchor">#</a> Install support software</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> jq -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="setup-environment"><a href="#setup-environment" class="header-anchor">#</a> Setup environment</h3> <p>Each validator has its own specific environment and therefore will have to modify the variables according to its setup.<br> <strong>The following setups are general guidelines</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token environment constant">$HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">UPDATE_PROFILE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token environment constant">$HOME</span>/.profile_update_cnd&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export HOME_CND=&quot;'</span><span class="token environment constant">$HOME</span><span class="token string">'/.cnd&quot;'</span> <span class="token operator">&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export HOME_CND_CONFIG=&quot;<span class="token variable">$HOME_CND</span>/config&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export HOME_CND_DATA=&quot;<span class="token variable">$HOME_CND</span>/data&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export HOME_CNCLI=&quot;'</span><span class="token environment constant">$HOME</span><span class="token string">'/.cncli&quot;'</span> <span class="token operator">&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export APP_TOML=&quot;<span class="token variable">$HOME_CND_CONFIG</span>/app.toml&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export BIN_DIR=&quot;'</span><span class="token environment constant">$HOME</span><span class="token string">'/go/bin&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export SRC_GIT_DIR=&quot;'</span><span class="token environment constant">$HOME</span><span class="token string">'/commercionetwork&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export BUILD_DIR=&quot;<span class="token variable">$SRC_GIT_DIR</span>/build&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export NEW_CHAIN_ID=&quot;&lt;new_chain_id&gt;&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export CHAIN_ID=&quot;&lt;old_chain_id&gt;&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export BUILD_VERSION=&quot;&lt;new_version&gt;&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export ALT_BLOCK=&lt;stop_block_height&gt;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export NEW_GENESIS_TIME=&quot;&lt;genesis_time&gt;&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>

<span class="token builtin class-name">source</span> <span class="token variable">$UPDATE_PROFILE</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;. <span class="token variable">$UPDATE_PROFILE</span>&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token environment constant">$HOME</span>/.profile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="compile-new-executables"><a href="#compile-new-executables" class="header-anchor">#</a> Compile new executables</h3> <p>In order to properly update your validator node, first of all you need to clone the
<a href="https://github.com/commercionetwork/commercionetwork" target="_blank" rel="noopener noreferrer"><code>commercionetwork</code> repo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/commercionetwork/commercionetwork.git <span class="token variable">$SRC_GIT_DIR</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Once downloaded, you need to compile the binaries with correct version:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token variable">$SRC_GIT_DIR</span>
<span class="token function">git</span> pull
<span class="token function">git</span> checkout <span class="token variable">$BUILD_VERSION</span>
<span class="token function">git</span> pull
<span class="token function">make</span> build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Verify your version</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./build/cnd version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>should be the same value of <code>&lt;new_version&gt;</code></p> <h3 id="setup-height-to-stop-the-chain"><a href="#setup-height-to-stop-the-chain" class="header-anchor">#</a> Setup height to stop the chain</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sed</span> -e <span class="token string">&quot;s|halt-height = .*|halt-height = <span class="token variable">$ALT_BLOCK</span>|g&quot;</span> <span class="token punctuation">\</span>
  <span class="token variable">$APP_TOML</span> <span class="token operator">&gt;</span> <span class="token variable">$APP_TOML</span>.tmp
<span class="token function">mv</span> <span class="token variable">$APP_TOML</span>.tmp <span class="token variable">$APP_TOML</span>
<span class="token function">sudo</span> <span class="token function">service</span> cnd restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="control-if-chain-is-stopped"><a href="#control-if-chain-is-stopped" class="header-anchor">#</a> Control if chain is stopped</h3> <p>After the block <code>&lt;stop_block_height&gt;</code> a chain stop message should appear at the indicated block.
To verify that the chain is actually locked check with reading the logs</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> journalctl -u cnd -f
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="stop-services"><a href="#stop-services" class="header-anchor">#</a> Stop services</h3> <p>Make sure you have stopped services and export the chain</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl stop cnd
<span class="token function">sudo</span> systemctl stop cncli <span class="token comment"># if you running rest server</span>
<span class="token function">sudo</span> <span class="token function">pkill</span> cnd
<span class="token function">sudo</span> <span class="token function">pkill</span> cncli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>and control it reading the logs</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> journalctl -u cnd -f
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="export-chain-state"><a href="#export-chain-state" class="header-anchor">#</a> Export chain state</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cnd <span class="token builtin class-name">export</span> --for-zero-height <span class="token operator">&gt;</span> <span class="token environment constant">$HOME</span>/export_for_<span class="token variable">$NEW_CHAIN_ID</span>.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="backup-executables"><a href="#backup-executables" class="header-anchor">#</a> Backup executables</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> -r <span class="token variable">$BIN_DIR</span>/cnd <span class="token variable">$BIN_DIR</span>/cnd.back
<span class="token function">cp</span> -r <span class="token variable">$BIN_DIR</span>/cncli <span class="token variable">$BIN_DIR</span>/cncli.back
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="changing-executables"><a href="#changing-executables" class="header-anchor">#</a> Changing executables</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> <span class="token variable">$BUILD_DIR</span>/cn* <span class="token variable">$BIN_DIR</span>/.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="migrate-chain"><a href="#migrate-chain" class="header-anchor">#</a> Migrate chain</h3> <p>Try to find out migrate version from list of current migration</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cnd migrations-list 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If you find <code>&lt;new_version&gt;</code> in the ouput command you ca use the follow command</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cnd migrate <span class="token punctuation">\</span>
  <span class="token variable">$BUILD_VERSION</span> <span class="token punctuation">\</span>
  <span class="token environment constant">$HOME</span>/export_for_<span class="token variable">$NEW_CHAIN_ID</span>.json <span class="token punctuation">\</span>
  --chain-id <span class="token variable">$NEW_CHAIN_ID</span> <span class="token punctuation">\</span>     
  --genesis-time <span class="token variable">$NEW_GENESIS_TIME</span> <span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  <span class="token environment constant">$HOME</span>/genesis_for_<span class="token variable">$NEW_CHAIN_ID</span>.json
  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>If you don't find <code>&lt;new_version&gt;</code> in the valid migrations list use</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token environment constant">$HOME</span>/export_for_<span class="token variable">$NEW_CHAIN_ID</span>.json <span class="token operator">|</span> <span class="token punctuation">\</span>
  jq <span class="token string">'.genesis_time=&quot;'</span><span class="token variable">$NEW_GENESIS_TIME</span><span class="token string">'&quot;'</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
  jq <span class="token string">'.chain_id=&quot;'</span><span class="token variable">$NEW_CHAIN_ID</span><span class="token string">'&quot;'</span> <span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  <span class="token environment constant">$HOME</span>/genesis_for_<span class="token variable">$NEW_CHAIN_ID</span>.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="check-hash-of-genesis"><a href="#check-hash-of-genesis" class="header-anchor">#</a> Check hash of genesis</h3> <p>To confirm that all validator nodes have produced the same genesis, a comparison must be made between all update participants to demonstrate the consistency of the data.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>jq -S -c -M <span class="token string">''</span> <span class="token environment constant">$HOME</span>/genesis_for_<span class="token variable">$NEW_CHAIN_ID</span>.json <span class="token operator">|</span> shasum -a <span class="token number">256</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Compare the value of the hash obtained with all other participants in the update</p> <h3 id="backup"><a href="#backup" class="header-anchor">#</a> Backup</h3> <p>Before starting the update it is recommended to take a full data snapshot of the chain state at the export height.<br>
To do so please run:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl stop cnd
systemctl stop cncli <span class="token comment"># if you running rest server</span>
<span class="token function">mkdir</span> <span class="token variable">$HOME_CND</span><span class="token builtin class-name">.</span><span class="token variable">$CHAIN_ID</span>
<span class="token function">mv</span> <span class="token variable">$HOME_CND_DATA</span> <span class="token variable">$HOME_CND</span><span class="token builtin class-name">.</span><span class="token variable">$CHAIN_ID</span>/.
<span class="token function">cp</span> -r <span class="token variable">$HOME_CND_CONFIG</span> <span class="token variable">$HOME_CND</span><span class="token builtin class-name">.</span><span class="token variable">$CHAIN_ID</span>/.
<span class="token function">cp</span> -r <span class="token variable">$HOME_CNCLI</span> <span class="token variable">$HOME_CNCLI</span><span class="token builtin class-name">.</span><span class="token variable">$CHAIN_ID</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="reset-chain-and-change-geneis-file"><a href="#reset-chain-and-change-geneis-file" class="header-anchor">#</a> Reset chain and change geneis file</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cnd unsafe-reset-all
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> <span class="token environment constant">$HOME</span>/genesis_for_<span class="token variable">$NEW_CHAIN_ID</span>.json <span class="token variable">$HOME_CND_CONFIG</span>/genesis.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="restart-chain"><a href="#restart-chain" class="header-anchor">#</a> Restart chain</h3> <p>Before restarting the chain we have to reset the value for height for the stop to zero.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sed</span> -e <span class="token string">&quot;s|halt-height = .*|halt-height = 0|g&quot;</span> <span class="token punctuation">\</span>
  <span class="token variable">$APP_TOML</span> <span class="token operator">&gt;</span> <span class="token variable">$APP_TOML</span>.tmp
<span class="token function">mv</span> <span class="token variable">$APP_TOML</span>.tmp <span class="token variable">$APP_TOML</span>
systemctl start cnd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="control-chain-restart"><a href="#control-chain-restart" class="header-anchor">#</a> Control chain restart</h3> <p>The new chain should restart at the time set in the <code>genesis_time</code>.<br>
Control if the sync starts. Use <code>Ctrl + C</code> to interrupt the <code>journalctl</code> command</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>journalctl -u cnd -f
<span class="token comment"># OUTPUT SHOULD BE LIKE BELOW AFTER GENESI TIME</span>
<span class="token comment">#</span>
<span class="token comment"># Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.722] Executed block                               module=state height=1 validTxs=0 invalidTxs=0</span>
<span class="token comment"># Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.728] Committed state                              module=state height=1 txs=0 appHash=9815044185EB222CE9084AA467A156DFE6B4A0B1BAAC6751DE86BB31C83C4B08</span>
<span class="token comment"># Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.745] Executed block                               module=state height=2 validTxs=0 invalidTxs=0</span>
<span class="token comment"># Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.751] Committed state                              module=state height=2 txs=0 appHash=96BFD9C8714A79193A7913E5F091470691B195E1E6F028BC46D6B1423F7508A5</span>
<span class="token comment"># Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.771] Executed block                               module=state height=3 validTxs=0 invalidTxs=0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="restart-the-rest-api-if-you-need"><a href="#restart-the-rest-api-if-you-need" class="header-anchor">#</a> Restart the REST API if you need</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>cncli config chain-id $NEW_CHAIN_ID
cncli rest-server --chain-id $NEW_CHAIN_ID --trust-node
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="update-type-2-soft-fork"><a href="#update-type-2-soft-fork" class="header-anchor">#</a> Update type 2 - Soft fork</h2> <p>This type of upgrade is generally optional: it is released to fix some minor bugs in the software and does not change the status of the chain</p> <h3 id="preliminary-risks-2"><a href="#preliminary-risks-2" class="header-anchor">#</a> Preliminary/Risks</h3> <p>When signalling a optional update that should follow this procedure, the following information will
be let known to all validators:</p> <ol><li>The new chain software version: <code>&lt;new_version&gt;</code></li></ol> <p>If you are a validator, please make sure that you know all those information before proceeding with the update.</p> <h3 id="setup-environment-2"><a href="#setup-environment-2" class="header-anchor">#</a> Setup environment</h3> <p>Each validator has its own specific environment and therefore will have to modify the variables according to its setup.<br> <strong>The following setups are general guidelines</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token environment constant">$HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">UPDATE_PROFILE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token environment constant">$HOME</span>/.profile_update_cnd&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export HOME_CND=&quot;'</span><span class="token environment constant">$HOME</span><span class="token string">'/.cnd&quot;'</span> <span class="token operator">&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export HOME_CND_CONFIG=&quot;<span class="token variable">$HOME_CND</span>/config&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export HOME_CND_DATA=&quot;<span class="token variable">$HOME_CND</span>/data&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export BIN_DIR=&quot;'</span><span class="token environment constant">$HOME</span><span class="token string">'/go/bin&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export SRC_GIT_DIR=&quot;'</span><span class="token environment constant">$HOME</span><span class="token string">'/commercionetwork&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export BUILD_DIR=&quot;<span class="token variable">$SRC_GIT_DIR</span>/build&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>
<span class="token builtin class-name">echo</span> <span class="token string">'export BUILD_VERSION=&quot;&lt;new_version&gt;&quot;'</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$UPDATE_PROFILE</span>

<span class="token builtin class-name">source</span> <span class="token variable">$UPDATE_PROFILE</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;. <span class="token variable">$UPDATE_PROFILE</span>&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token environment constant">$HOME</span>/.profile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="compile-new-executables-2"><a href="#compile-new-executables-2" class="header-anchor">#</a> Compile new executables</h3> <p>In order to properly update your validator node, first of all you need to clone the
<a href="https://github.com/commercionetwork/commercionetwork" target="_blank" rel="noopener noreferrer"><code>commercionetwork</code> repo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/commercionetwork/commercionetwork.git <span class="token variable">$SRC_GIT_DIR</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Once downloaded, you need to compile the binaries with correct version:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token variable">$SRC_GIT_DIR</span>
<span class="token function">git</span> pull
<span class="token function">git</span> checkout <span class="token variable">$BUILD_VERSION</span>
<span class="token function">git</span> pull
<span class="token function">make</span> build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Verify your version</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./build/cnd version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>should be the same value of <code>&lt;new_version&gt;</code></p> <h3 id="backup-executables-2"><a href="#backup-executables-2" class="header-anchor">#</a> Backup executables</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> -r <span class="token variable">$BIN_DIR</span>/cnd <span class="token variable">$BIN_DIR</span>/cnd.back
<span class="token function">cp</span> -r <span class="token variable">$BIN_DIR</span>/cncli <span class="token variable">$BIN_DIR</span>/cncli.back
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="restart-chain-changing-executables"><a href="#restart-chain-changing-executables" class="header-anchor">#</a> Restart chain changing executables</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl stop cnd
<span class="token function">sudo</span> systemctl stop cncli
<span class="token function">cp</span> <span class="token variable">$BUILD_DIR</span>/cn* <span class="token variable">$BIN_DIR</span>/.
<span class="token function">sudo</span> systemctl start cnd
<span class="token function">sudo</span> systemctl start cncli

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="control-chain-restart-2"><a href="#control-chain-restart-2" class="header-anchor">#</a> Control chain restart</h3> <p>The new chain should restart at the time set in the <code>genesis_time</code>.<br>
Control if the sync starts. Use <code>Ctrl + C</code> to interrupt the <code>journalctl</code> command</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>journalctl -u cnd -f
<span class="token comment"># OUTPUT SHOULD BE LIKE BELOW AFTER GENESI TIME</span>
<span class="token comment">#</span>
<span class="token comment"># Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.722] Executed block                               module=state height=1 validTxs=0 invalidTxs=0</span>
<span class="token comment"># Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.728] Committed state                              module=state height=1 txs=0 appHash=9815044185EB222CE9084AA467A156DFE6B4A0B1BAAC6751DE86BB31C83C4B08</span>
<span class="token comment"># Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.745] Executed block                               module=state height=2 validTxs=0 invalidTxs=0</span>
<span class="token comment"># Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.751] Committed state                              module=state height=2 txs=0 appHash=96BFD9C8714A79193A7913E5F091470691B195E1E6F028BC46D6B1423F7508A5</span>
<span class="token comment"># Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.771] Executed block                               module=state height=3 validTxs=0 invalidTxs=0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="update-type-3-reset-reinstall-chain"><a href="#update-type-3-reset-reinstall-chain" class="header-anchor">#</a> Update type 3 - Reset/reinstall chain</h2> <p>This procedure is very rare and is only performed in borderline cases.<br>
With this process the chain is completely reinitialized and a new genesis is produced by the chain management system.<br>
Usually this procedure is applied on development and test chains.</p> <h3 id="backup-executables-3"><a href="#backup-executables-3" class="header-anchor">#</a> Backup executables</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> -r <span class="token variable">$BIN_DIR</span>/cnd <span class="token variable">$BIN_DIR</span>/cnd.back
<span class="token function">cp</span> -r <span class="token variable">$BIN_DIR</span>/cncli <span class="token variable">$BIN_DIR</span>/cncli.back
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="backup-chain-database"><a href="#backup-chain-database" class="header-anchor">#</a> Backup chain database</h3> <p>Before starting the update it is recommended to take a full data snapshot of the chain state at the export height.<br>
To do so please run:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl stop cnd
systemctl stop cncli <span class="token comment"># if you running rest server</span>
<span class="token function">mkdir</span> <span class="token variable">$HOME_CND</span><span class="token builtin class-name">.</span><span class="token variable">$CHAIN_ID</span>
<span class="token function">mv</span> <span class="token variable">$HOME_CND_DATA</span> <span class="token variable">$HOME_CND</span><span class="token builtin class-name">.</span><span class="token variable">$CHAIN_ID</span>/.
<span class="token function">cp</span> -r <span class="token variable">$HOME_CND_CONFIG</span> <span class="token variable">$HOME_CND</span><span class="token builtin class-name">.</span><span class="token variable">$CHAIN_ID</span>/.
<span class="token function">cp</span> -r <span class="token variable">$HOME_CNCLI</span> <span class="token variable">$HOME_CNCLI</span><span class="token builtin class-name">.</span><span class="token variable">$CHAIN_ID</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="reinstall-node"><a href="#reinstall-node" class="header-anchor">#</a> Reinstall node</h3> <p>Follow all steps in <a href="/docs2.1.2/nodes/full-node-installation.html">Installing a full node</a><br>
Follow all steps in <a href="/docs2.1.2/nodes/validator-node-installation.html">Becoming a validator</a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/commercionetwork/commercionetwork/edit/master/docs/docs2.1.2/nodes/validator-node-update.md" target="_blank" rel="noopener noreferrer">Edit this page on Github</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/4/2021, 10:50:18 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs2.1.2/nodes/validator-node-handling.html" class="prev">
        Handling a validator
      </a></span> <span class="next"><a href="/docs2.1.2/app_developers/">
        Introduction
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e5cb1680.js" defer></script><script src="/assets/js/2.5e9ff84b.js" defer></script><script src="/assets/js/27.fc3305c3.js" defer></script>
  </body>
</html>
